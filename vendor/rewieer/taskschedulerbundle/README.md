# Task Scheduler Bundle

A task scheduler for **Symfony** applications using [CRON](https://en.wikipedia.org/wiki/Cron) jobs porting that allows you to run tasks periodically.


## Requirements

For this bundle to work, you must be able to define *CRON* jobs on your server.


## Installation

Start by adding the bundle to your *composer.json* : `composer require rewieer/taskschedulerbundle`

Symfony Flex will automatically enable that bundle for you. If you are not using Flex yet, add the bundle to your *AppKernel.php* :
```php
// in AppKernel::registerBundles()
$bundles = array(
    // ...
    new Rewieer\TaskSchedulerBundle\RewieerTaskSchedulerBundle(),
    // ...
);
```

You're ready to start scheduling!


## Usage

First, add the following line to your *CRON* tabs : `* * * * * php /path/to/your/project/bin/console ts:run >> /dev/null 2>&1`
>This will call the scheduler, which will review all scheduled tasks and dispatch accordingly. You can call a task directly by providing it's **ID** as a parameter to the command. Note that this **ID** is generated by the scheduler and is in no way related to the service itself.

>The `>> /dev/null 2>&1` option discards the printed results of the tasks. Removing it allows to send it by email instead. This may vary so please refer to your server's configuration.

You then need to create a task. Tasks can be any service! You just have to give it the `ts.task` tag and implement `TaskInterface`, or for simplicity extend from `AbstractScheduledTask`.

### Every X Minutes

In `Foo\Bar\Task` to schedule a task **every 5 minutes**:

```php
use Rewieer\TaskSchedulerBundle\Task\AbstractScheduledTask;
use Rewieer\TaskSchedulerBundle\Task\Schedule;

class Task extends AbstractScheduledTask {
  protected function initialize(Schedule $schedule) {
    $schedule
      ->everyMinutes(5); // Perform the task every 5 minutes
  }

  public function run() {
    // Do stuff
  }
}
```

Your task is now scheduled and will be called every 5 minutes.  

### Every X Hours or Daily

if you are scheduling your task on an hourly or daily basis, you'll need to set `minutes()` in addition to `hours()`, `everyHours()`, or `daily()`.  **If you omit `minutes()`, the task will run every minute on the scheduled hour(s).**

In `Foo\Bar\Task` to schedule a task **every 5 hours**:

```php
use Rewieer\TaskSchedulerBundle\Task\AbstractScheduledTask;
use Rewieer\TaskSchedulerBundle\Task\Schedule;

class Task extends AbstractScheduledTask {
  protected function initialize(Schedule $schedule) {
    $schedule
      ->minutes(0)
      ->everyHours(5); // Perform the task every 5 hours on minute 0
      
    // Or if you want to perform your task at midnight every day
    // $schedule->minutes(0)->hours(0)->daily();
    
    // Or schedule your task to run once at 9AM daily (this is effectively the same as daily() above)
    // $schedule->minutes(0)->hours(9);
  }

  public function run() {
    // Do stuff
  }
}
```

You're good to go! You can now check your logs to see if this is working.
