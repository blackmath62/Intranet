{% extends 'base.html.twig' %}

{% block title %}
	{{ title }}
{% endblock %}

{% block body %}
	<div class="btn-group mb-2 text-center col-12">
		<a href="{{ path('app_scan_ean_alim_empl') }}" class="text-white btn btn-primary col-6">
			<i class="fa fa-plus mr-2"></i>Nouvelle Empl.
		</a>
		<a href="{{ path('app_search_products')}}" class="text-white btn btn-secondary col-6">
			<i class="fa-solid fa-magnifying-glass mr-2"></i>
		</i>Rech. prod.
	</a>
</div>
<!-- general form elements disabled -->
<div class="card card-navy">
	<div class="card-header d-flex">
		<h3 class="card-title">Alimentation d'emplacement</h3>
		<a href="{{ path('app_scan_emplacement_ns') }}" class="badge badge-danger ml-auto">Non soumis</a>
	</div>
	<!-- /.card-header -->
	<div class="card-body">
		{{ form_start(form, { 'attr' : { 'class' : 'ml-auto' }}) }}
		<div class="form-group">
			<label class="col-form-label">
				<i class="fas fa-map-marker-alt"></i>
				Emplacement
			</label>
			<div class="input-group">
				<div class="input-group-prepend">
					<button id="btn-emplacement" class="btn btn-warning" type="button" data-toggle="modal" data-target="#scannerModal" data-target-id="emplacement">
						<i class="fa-solid fa-camera"></i>
					</button>
				</div>
				{{ form_widget(form.emplacement, {'id': 'emplacement', 'name': 'emplacement' ,'attr' : { 'class' : 'form-control col-12 is-invalid' , 'value' : emplacement} }) }}
				{{ form_errors(form.emplacement) }}
			</div>
		</div>
		<div class="form-group mt-2">
			<label class="col-form-label" for="ean">
				<i class="fas fa-barcode"></i>
				{{ form_label(form.ean) }}
			</label>
			<div class="input-group">
				<div class="input-group-prepend">
					<button id="btn-ean" class="btn btn-warning" type="button" data-toggle="modal" data-target="#scannerModal" data-target-id="ean">
						<i class="fa-solid fa-camera"></i>
					</button>
				</div>
				{{ form_widget(form.ean, { 'id': 'ean', 'name': 'ean' , 'attr' : { 'class' : 'form-control col-12 is-warning' } }) }}
				{{ form_errors(form.ean) }}
				<div class="input-group-append">
					<button class="btn btn-secondary" type="button" id="openProductsModal">
						<i class="fa-solid fa-magnifying-glass"></i>
					</button>
				</div>
			</div>
			<div class="form-check form-check-lg mt-2">
				<input class="form-check-input" type="checkbox" id="openProductsCheckbox" checked>
				<label class="form-check-label" for="openProductsCheckbox">
					Uniquement les articles ouverts
				</label>
			</div>
		</div>
		<!-- /.card -->
		<!-- /.card-body -->
	</div>
	<div class='card-footer'>
		{{ form_row(form.save, {'attr' : { 'class' : 'btn btn-xl btn-warning col-12' } }) }}
		{{ form_end(form)}}
	</div>
	<!-- /.card -->
</div>
<!-- /.card-body -->
{% include 'components/product_card.html.twig' %}
{% include 'components/product_card_light.html.twig' %}
{% include 'components/modal_scanner.html.twig' %}
{% include 'components/modal_products.html.twig' %}

{% if historiques %}
	<div class="card card-dark mt-4">
		<div class="card-header">
			<h3 class="card-title">Actuellement sur cet emplacement</h3>
		</div>
		<!-- /.card-header -->
		<div class="card-body p-0">
			<table class="table table-sm">
				<thead>
					<tr>
						<th>Produit</th>
						<th style="width: 40px">X</th>
					</tr>
				</thead>
				<tbody>
					{% for historique in historiques %}
						<tr>
							<td>{{ historique.designation }}</td>
							<td class="text-align align-middle">
								<a data-toggle="modal" data-target={{"#modal-sm#{historique.id}"}} class="text-dark">
									<i class="fas fa-trash-alt"></i>
								</a>
								<div class="modal fade" id={{"modal-sm#{historique.id}"}}>
									<div class="modal-dialog modal-sm">
										<div class="modal-content">
											<div class="modal-header">
												<h4 class="modal-title">Voulez vous vraiment supprimer cette ligne ?</h4>
												<button type="button" class="close" data-dismiss="modal" aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="card-footer p-0">
												<ul class="nav flex-column">
													<li class="nav-item">
														<small class="nav-link">
															Id :
															<span class="float-right">{{ historique.id }}</span>
														</small>
													</li>
													<li class="nav-item">
														<small class="nav-link">
															Ean :
															<span class="float-right">{{ historique.ean }}</span>
														</small>
													</li>
													<li class="nav-item">
														<small class="nav-link">
															Référence :
															<span class="float-right">{{historique.ref}}</span>
														</small>
													</li>
													{% if historique.sref1 %}
														<li class="nav-item">
															<small class="nav-link">
																Sref1 :
																<span class="float-right">{{historique.sref1}}</span>
															</small>
														</li>
													{% endif %}
													{% if historique.sref2 %}
														<li class="nav-item">
															<small class="nav-link">
																Sref2 :
																<span class="float-right">{{historique.sref2}}</span>
															</small>
														</li>
													{% endif %}
													<li class="nav-item">
														<small class="nav-link">
															Désignation :
															<span class="float-right">{{historique.designation}}</span>
														</small>
													</li>
													<li class="nav-item">
														<small class="nav-link">
															Unité de vente :
															<span class="float-right">{{historique.uv}}</span>
														</small>
													</li>
												</ul>
											</div>
											<div class="modal-footer justify-content-between">
												<button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
												<a href="{{path('app_emplacement_scan_ean-delete', {'id' : historique.id, 'emplacement' : app.request.attributes.get('emplacement') })}}" type="button" class="btn btn-danger">Supprimer cette ligne</a>
											</div>
										</div>
										<!-- /.modal-content -->
									</div>
									<!-- /.modal-dialog -->
								</div>
								<!-- /.modal -->
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		<!-- /.card-body -->
	</div>
	<!-- /.card -->

	<a data-toggle="modal" data-target="#modal-sm-supprimer" class="text-white btn btn-danger col-12">Supprimer cette saisie définitivement</a>
	<div class="modal fade" id="modal-sm-supprimer">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Voulez vous vraiment supprimer intégralement et définitivement cet emplacement
						{{app.request.attributes.get('emplacement')}}
						?</h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-footer justify-content-between">
					<button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
					<a href="{{path('app_emplacement_scan_ean_delete_all', {'emplacement' : app.request.attributes.get('emplacement') })}}" type="button" class="btn btn-danger">Supprimer</a>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<!-- /.modal -->
{% endif %}{% endblock %}{% block javascripts %}
{{ parent() }}<script src="https://unpkg.com/html5-qrcode"></script>
<script src="{{ asset("js/html5-qrcode.min.js")}}"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>{{ productFormScript | raw }}</script>
<script>{{ eanScannerScript | raw }}</script>
<script></script>{% endblock %}
