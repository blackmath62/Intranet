{% extends 'base.html.twig' %}

{% block title %}Page des Tickets
{% endblock %}

{% block body %}
	<section
		class="content-header">

		<!-- /.Création -->
		<div class="card card-dark">
			<div class="card-header d-flex">
				<h3 class="card-title">Ajouter un commentaire au ticket</h3>
				<a href="{{ path('app_tickets') }}" class="badge badge-success ml-auto">Retourner à la liste des Tickets</a>
			</div>
			<div class="card card-light border m-2">
				<div class="card-header">
					<div class="d-flex ">
						<h2 class="card-title mr-auto p-2">{{ ticket.title}}</h2>
						<div>
							<a class="btn btn-sm" style="background-color: {{ ticket.priority.color }}; color: {{ ticket.priority.textColor }}" ;>{{ ticket.priority.title }}</a>
							<h2 class="card-title p-2">
								{{ ticket.user.pseudo}}
								le
								{{ ticket.createdAt|date("d/m/Y")}}
								à
								{{ ticket.createdAt|date("H:i")}}
							</h2>
						</div>
					</div>
				</div>

				<div class="card-body">
					<div class="form-group col-12">
						<label for="exampleInputEmail1">Objet</label>
						<h3 type="text" name="objet" id="objet">{{ ticket.title}}</h3>
					</div>
					<div class='d-flex flex-wrap'>
						<div class="form-group col-2">
							<label for="exampleInputPassword1">Date ouverture</label>
							<div>{{ ticket.createdAt|date("d/m/Y")}}</div>
						</div>
						<div class="form-group col-2">
							<label for="exampleInputPassword1">Date clotûre</label>
							{% if  ticket.closedAt  %}
								<div>{{ ticket.closedAt|date("d/m/Y")}}</div>
							{% endif %}
						</div>
						<div class="form-group col-2">
							<label for="exampleInputPassword1">Service</label>
							<div>
								<a class="btn btn-xl" style="background-color: {{ ticket.service.color }}; color: {{ ticket.service.textColor }}" ;>{{ ticket.service.title }}</a>
							</div>
						</div>
						<div class="form-group col-2">
							<label for="exampleInputPassword1">Statut</label>
							<div>
								<a class="btn btn-xl" style="background-color: {{ ticket.statu.backgroundColor }}; color: {{ ticket.statu.textColor }}" ;>{{ ticket.statu.title }}</a>
							</div>
						</div>
						<div class="form-group col-2">
							<img class="img-fluid col-12" src="{{ asset(ticket.societe.img )}}">
						</div>
					</div>
					<div class="form-group col-12">
						<label for="exampleInputPassword1">Détail :
						</label>
						<article>{{ ticket.content|raw}}</article>
					</div>
					{% if ticket.file %}
						<div class="form-group col-12">
							<label>Fichiers joints :
							</label>
							<a href="{{ asset(asset('doc/tickets/' ~ ticket.file))}}" id="lien" name="lien" class="text-center btn btn-outline-info btn-xs">{{ ticket.file}}</a>
						</div>
					{% endif %}
					{% set countComments = 0 %}
					{% for comment in comments %}
						{% if comment.ticket.id == ticket.id %}
							{% set countComments = countComments + 1 %}
						{% endif %}
					{% endfor %}
					{% if countComments > 0 %}
						<div class="form-group">
							<h5>Commentaires :
							</h5>
						</div>
					{% endif %}
					<section class="content">
						<div class="container-fluid">
							<div class="row">
								<div class="col-md-12">
									<div class="timeline">
										{% for comment in comments %}
											<div>
												{% if comment.ticket.id == ticket.id %}
													<i class="fas fa-comments bg-maroon"></i>
													<div class="timeline-item">
														<span class="time">{{ comment.CreatedAt|date("d/m/Y")}}
															à
															{{ comment.CreatedAt|date("H:i")}}</span>
														<h3 class="timeline-header">Déposé par
															{{ comment.user.pseudo }}</h3>
														<h4 class="timeline-body">{{ comment.title|raw}}</h4>
														<div class="timeline-body">{{ comment.content|raw}}</div>
													</div>
												{% endif %}
											</div>
										{% endfor %}


										{% if countComments > 0 %}
											<div>
												<i class="fas fa-clock bg-gray"></i>
											</div>

										{% endif %}
									</div>
								</div>
							</div>
						</div>
					</section>
					<div class='row'>
						{% if is_granted('ROLE_ADMIN') %}
							<div class="form-group mx-auto align-center">
								<a href=" {{ path('app_contact') }}" class="btn btn-danger">
									<i class="fas fa-envelope mr-2"></i>
									Envoyer par mail à Progiteam
								</a>
							</div>
							<div class="form-group mx-auto align-center">
								<a href=" {{ path('app_contact') }}" class="btn btn-info">
									<i class="fas fa-envelope mr-2"></i>
									Envoyer par mail à F-18
								</a>
							</div>
							<div class="form-group mx-auto align-center">
								<a href=" {{ path('app_contact') }}" class="btn btn-warning">
									<i class="fas fa-envelope mr-2"></i>
									Envoyer par mail à Document Solution 62
								</a>
							</div>
						{% endif %}
					</div>

				</div>
			</div>

		</div>
		<!-- Main content -->
		<section class="content">
			<div class="row">
				<div class="col-md-12">
					<div class="card card-outline card-info">
						<div class="card-header">
							<h3 class="card-title">
								Déposer un Commentaire
							</h3>
						</div>
						<!-- /.card-header -->
						<div class="card-body pad">
							<div class="mb-3">
								{% if is_granted('ROLE_ADMIN') %}
									{{ form(formstatu)}}{% endif %}
									{{ form(formComment)}}
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- /.col-->
				</div>
				<!-- ./row -->
			</section>
			<!-- /.content -->
		</section>


		<script>
			tinymce.init({
selector: 'textarea',
height: 500,
menubar: false,
plugins: [
'advlist autolink link lists image charmap print preview anchor textcolor', 'searchreplace visualblocks code fullscreen', 'insertdatetime media table contextmenu paste code help'
],
toolbar: 'insert | undo redo | styleselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help'
});
		</script>
		<script>
			$(function () {
$('.textarea').summernote()
})
		</script>
	{% endblock %}
